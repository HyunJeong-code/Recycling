<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="recycling.seller.dao.face.SellingDao">

	<sql id="selectExp">
	SELECT * FROM Exp
	</sql>
	
	<select id="selectAllrcyPrd" parameterType="String" resultType="Prd">
		SELECT * FROM prd
		<where>
			AND s_code = #{sCode}
			AND ct_pno = 0
		</where>
		ORDER BY prd_code DESC
	</select>
	
	<select id="selectAllupcyPrd" parameterType="String" resultType="Prd">
		SELECT * FROM prd
		<where>
			AND s_code = #{sCode}
			AND ct_pno = 1
		</where>
		ORDER BY prd_code DESC
	</select>
	
	<select id="selectAllMyOrder" parameterType="String" resultType="MyOrder">
		SELECT 
			ORDDT_CODE, od.ORD_CODE, PRD_CODE, od.ORD_NAME, ORD_PRICE, ORD_CNT, od.ORD_SUM, STT_NO, ORD_DATE
		FROM 
			order_detail od, orders o
		<where>
			AND o.ord_code = od.ord_code
			AND od.prd_code = #{prdCode}
		</where>
	</select>
	
	<update id="deletePrd" parameterType="String">
		UPDATE prd
		SET prd_out = 'Y',
			prd_cnt = 0
		<where>
			prd_code = #{prdCode}
		</where>
	</update>
	
	<select id="selectByprdCode" parameterType="String" resultType="Prd">
		SELECT * FROM prd
		<where>
			prd_code = #{prdCode}
		</where>
	</select>
	
	<update id="updatePrd" parameterType="Prd">
		UPDATE prd
		SET ct_pdtno = #{ctPdtNo},
			prd_name = #{prdName},
			price = #{price},
			prd_cnt = #{prdCnt},
			prd_detail = #{prdDetail}
		<where>
			prd_code = #{prdCode}
		</where>
	</update>

	<select id="selectMyExpList" parameterType="recycling.util.Paging" resultType="Exp">
		SELECT * FROM (
			SELECT rownum rnum, E.* FROM (
				<include refid="selectExp"/>
				<where>
					AND exp_name LIKE '%' || #{search } || '%' 
						OR exp_code LIKE '%' || #{search } || '%' 
				</where>
				ORDER BY exp_code
			) E
		)
		<where>
			AND rnum BETWEEN #{startNo} AND #{endNo}
		</where>
	</select>
	
	
	<select id="selectCntAll" parameterType="string" resultType="int">
		SELECT count(*) FROM Exp
		<where>
			AND exp_name LIKE '%' || #{key } || '%' 
				OR exp_code LIKE '%' || #{search } || '%'
		</where>
		ORDER BY exp_date DESC
	</select>
	
	<select id="selectPageAll" resultType="int">
		SELECT COUNT(*) FROM (
			SELECT * FROM exp_res
			<where>
				AND sch_no = #{schNo}
			</where>
		)
	</select>
	
	<select id="selectByExp" parameterType="string" resultType="Exp">
		SELECT * FROM exp
		<where>
			AND exp_code = #{expCode}
		</where>
	</select>
	
	<select id="selectResList" parameterType="recycling.util.Paging" resultType="ExpRes">
		SELECT * FROM (
			SELECT rownum rnum, B.* FROM (
				SELECT * FROM exp_res	
				ORDER BY sch_no
			) B
		)
		<where>
			AND rnum BETWEEN #{startNo } AND #{endNo }
		</where>
	</select>
	

</mapper>