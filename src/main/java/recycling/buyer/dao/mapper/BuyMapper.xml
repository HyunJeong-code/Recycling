<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="recycling.buyer.dao.face.BuyDao">
	
	<select id="selectById" parameterType="string" resultType="BuyerLogin">
		SELECT B.b_code, B.b_ct_code, B.b_id, B.b_pw, B.b_out, S.s_code, S.s_chk, S.s_out 
		FROM buyer B, seller S
		<where>
			AND B.b_code = S.b_code(+)
			AND B.b_id = #{username }
		</where> 
	</select>
	
	<insert id="insertBuyer" parameterType="Buyer" useGeneratedKeys="true" keyProperty="bCode" keyColumn="b_code">
		INSERT INTO buyer (b_code, b_ct_code, rank_no, b_id, b_pw, b_name, b_phone, b_email, b_entdate, ad_sms, ad_email, b_out, b_out_date)
		VALUES(
			'BUY' || lpad(buyer_seq.nextval, 7, '0'),
			#{bCtCode },
			DEFAULT,
			#{bId },
			#{bPw },
			#{bName },
			#{bPhone },
			#{bEmail },
			sysdate,
			#{adSms },
			#{adEmail },
			DEFAULT,
			null
		)
	</insert>
	
	<select id="selectBybIdbPw" parameterType="Buyer" resultType="BuyerLogin">
		SELECT B.b_code, B.b_ct_code, B.b_id, B.b_pw, B.b_out, S.s_code, S.s_chk, S.s_out 
		FROM buyer B, seller S
		<where>
			AND B.b_code = S.b_code(+)
			AND B.b_id = #{bId }
			AND B.b_pw = #{bPw }
		</where> 
	</select>
	
	<select id="selectByBuyerId" parameterType="Buyer" resultType="string">
		SELECT b_id FROM buyer
		<where>
			AND b_name = #{bName }
			AND b_phone = #{bPhone }
			AND b_email = #{bEmail }
			AND b_out = 'N'
		</where>
	</select>
	
	<select id="selectByBuyerPw" parameterType="Buyer" resultType="Buyer">
		SELECT b_code, b_ct_code, rank_no, b_id, b_pw, b_name, b_phone, b_email, b_entdate, ad_sms, ad_email, b_out, b_out_date
		FROM buyer
		<where>
			AND b_id = #{bId }
			AND b_name = #{bName }
			AND b_phone = #{bPhone }
			AND b_email = #{bEmail }
			AND b_out = 'N'
		</where>
	</select>
	
	<update id="updatePw" parameterType="Buyer">
		UPDATE buyer
		SET b_pw = #{bPw }
		<where>
			AND b_code = #{bCode }
		</where>
	</update>
</mapper>