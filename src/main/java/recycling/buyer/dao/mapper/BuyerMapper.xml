<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="recycling.buyer.dao.face.BuyerDao">

	<!-- 구매자 아이디로 구매자 정보 조회 -->
	<select id="selectBuyerBybId" parameterType="string" resultType="recycling.dto.buyer.Buyer">
		SELECT B_Code AS bCode,
		       B_Ct_Code AS bCtCode,
		       B_Id AS bId,
		       B_Pw AS bPw,
		       B_Name AS bName,
		       B_Phone AS bPhone,
		       B_Email AS bEmail,
		       Ad_Sms AS adSms,
		       Ad_Email AS adEmail
		FROM Buyer
		<where>
			B_Id = #{bId }
		</where>
	</select>
	
	<!-- 구매자 코드로 배송지 조회 -->
	<select id="selectBuyerAdrBybCode" parameterType="string" resultType="recycling.dto.buyer.BuyerAdr">
		SELECT Addr_Code AS addrCode,
			   B_Code AS bCode,
			   Adr_Name AS adrName,
			   Adr_Postcode AS adrPostcode,
			   Adr_Addr AS adrAddr,
			   Adr_Detail AS adrDetail
		FROM Buyer_Adr
		<where>
			B_Code = #{bCode }
		</where>
	</select>
	
	<!-- 구매자 코드로 기업 정보 조회 -->
	<select id="selectCmpBybCode" parameterType="string" resultType="recycling.dto.buyer.Cmp">
        SELECT Cmp_Code AS cmpCode,
               B_Code AS bCode,
               Cmp_Name AS cmpName,
               Cmp_Ceo AS cmpCeo,
               Cmp_No AS cmpNo,
               Cmp_Postcode AS cmpPostcode,
               Cmp_Addr AS cmpAddr,
               Cmp_Detail AS cmpDetail
        FROM Cmp
        <where>
        	B_Code = #{bCode }
        </where>
    </select>
	
	<!-- 구매자 정보 업데이트 -->
    <update id="updateBuyer" parameterType="recycling.dto.buyer.Buyer">
        UPDATE Buyer
        SET B_Pw = #{bPw },
            B_Name = #{bName },
            B_Phone = #{bPhone },
            B_Email = #{bEmail },
            Ad_Sms = #{adSms },
            Ad_Email = #{adEmail }
        <where>
        	B_Code = #{bCode }
        </where>
    </update>
	
	<!-- 배송지 정보 업데이트 -->
    <update id="updateBuyerAdr" parameterType="recycling.dto.buyer.BuyerAdr">
        UPDATE Buyer_Adr
        SET Adr_Name = #{adrName },
            Adr_Phone = #{adrPhone },
            Adr_Postcode = #{adrPostcode },
            Adr_Addr = #{adrAddr },
            Adr_Detail = #{adrDetail }
        <where>
        	Adr_Code = #{adrCode }
        	AND B_Code = #{bCode }
        </where>
    </update>
	
	<!-- 기업 정보 업데이트 -->
    <update id="updateCmp" parameterType="recycling.dto.buyer.Cmp">
        UPDATE Cmp
        SET Cmp_Name = #{cmpName },
            Cmp_Ceo = #{cmpCeo },
            Cmp_No = #{cmpNo },
            Cmp_Postcode = #{cmpPostcode },
            Cmp_Addr = #{cmpAddr },
            Cmp_Detail = #{cmpDetail }
        <where>
        	Cmp_Code = #{cmpCode }
        	AND B_Code = #{bCode }
        </where>
    </update>
    
    <!-- 배송지 정보 등록 -->
    <insert id="insertBuyerAdr" parameterType="recycling.dto.buyer.BuyerAdr">
        INSERT INTO 
        	Buyer_Adr (Adr_Code, B_Code, Adr_Name, Adr_Phone, Adr_Postcode, Adr_Addr, Adr_Detail, Adr_Chk)
        VALUES 
        	(#{adrCode }, #{bCode }, #{adrName }, #{adrPhone }, #{adrPostcode }, #{adrAddr }, #{adrDetail }, #{adrChk })
    </insert>

    <!-- 배송지 정보 삭제 -->
    <delete id="deleteBuyerAdr" parameterType="string">
        DELETE FROM Buyer_Adr
        <where>
        	Adr_Code = #{adrCode }
        </where>
    </delete>

    <!-- 구매자 배송지 목록 조회 -->
    <select id="selectBuyerAdrList" parameterType="string" resultType="recycling.dto.buyer.BuyerAdr">
        SELECT Adr_Code AS adrCode,
               B_Code AS bCode,
               Adr_Name AS adrName,
               Adr_Phone AS adrPhone,
               Adr_Postcode AS adrPostcode,
               Adr_Addr AS adrAddr,
               Adr_Detail AS adrDetail,
               Adr_Chk AS adrChk
        FROM Buyer_Adr
        <where>
        	B_Code = #{bCode }
        </where>
    </select>
	
</mapper>